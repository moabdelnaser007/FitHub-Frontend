<div class="gym-detail-page">
  <!-- Header -->
  <!-- Header -->
  <header class="top-nav">
    <a class="brand" routerLink="/"> FitHub </a>
    <nav class="nav-links">
      <a *ngFor="let link of navLinks" [routerLink]="link.isRoute ? link.href : null"
        [href]="link.isRoute ? null : link.href" (click)="handleNav(link, $event)">{{ link.label }}</a>
    </nav>
    <div class="auth-actions">
      <ng-container *ngIf="!isLoggedIn">
        <button class="ghost" routerLink="/login">Log in</button>
        <button class="primary" routerLink="/register">Sign Up</button>
      </ng-container>
      <ng-container *ngIf="isLoggedIn">
        <button class="profile-btn" (click)="navigateToProfile()" title="Go to Profile">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
              fill="currentColor" />
          </svg>
        </button>
        <button class="logout-btn" (click)="logout()" title="Logout">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
              fill="currentColor" />
          </svg>
        </button>
      </ng-container>
    </div>
  </header>

  <main class="page-main">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
      <a routerLink="/">Home</a>
      <span>/</span>
      <a routerLink="/find-gym">Search</a>
      <span>/</span>
      <span>{{ gymName }}</span>
    </nav>

    <!-- Gym Header -->
    <div class="gym-header">
      <h1>{{ gymName }}</h1>
      <div class="gym-meta">
        <span class="rating">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
          </svg>
          {{ rating }} stars
        </span>
        <span class="reviews">({{ reviewCount }} reviews)</span>
        <span class="location">{{ location }}</span>
      </div>
    </div>

    <!-- Image Gallery -->
    <div class="image-gallery">
      <div class="main-image">
        <img [src]="images[0]" [alt]="gymName" />
      </div>
      <div class="thumbnail-grid">
        <div class="thumbnail" *ngFor="let img of images.slice(1, 5)">
          <img [src]="img" [alt]="gymName" />
        </div>
        <button class="view-all-btn">View all photos</button>
      </div>
    </div>
    <div class="content-layout">
      <!-- Main Content -->
      <div class="main-content">
        <!-- Tabs -->
        <div class="tabs">
          <button class="tab-btn" [class.active]="activeTab === 'about'" (click)="setActiveTab('about')">
            About
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'facilities'" (click)="setActiveTab('facilities')">
            Facilities
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'schedule'" (click)="setActiveTab('schedule')">
            Schedule
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'plans'" (click)="setActiveTab('plans')">
            Plans
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- About Tab -->
          <div *ngIf="activeTab === 'about'" class="tab-panel">
            <h2>About the Gym</h2>
            <p class="about-text">{{ aboutText }}</p>

            <!-- Reviews Section -->
            <div class="reviews-section" *ngIf="reviews.length > 0" style="margin-top: 2.5rem;">
              <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Member Reviews</h2>
              <div class="reviews-list">
                <div class="review-card" *ngFor="let review of reviews"
                  style="border-bottom: 1px solid #e2e8f0; padding: 1.25rem 0;">
                  <div class="review-header"
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div class="avatar-placeholder"
                        style="width: 32px; height: 32px; background: #e0f2fe; color: #0284c7; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px;">
                        {{ review.userName.charAt(0).toUpperCase() }}
                      </div>
                      <span class="reviewer-name" style="font-weight: 600; color: #0f172a;">{{ review.userName }}</span>
                    </div>
                    <span class="review-date" style="color: #64748b; font-size: 0.85em;">{{ review.bookingDate |
                      date:'mediumDate' }}</span>
                  </div>
                  <div class="review-rating"
                    style="color: #f59e0b; font-size: 14px; margin-bottom: 0.75rem; display: flex; gap: 2px;">
                    <span *ngFor="let star of [1,2,3,4,5]">
                      <svg viewBox="0 0 24 24" [attr.fill]="star <= review.rating ? 'currentColor' : '#e2e8f0'"
                        width="16" height="16">
                        <path
                          d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                      </svg>
                    </span>
                  </div>
                  <p class="review-comment" style="color: #334155; margin: 0; line-height: 1.5;">{{ review.comment }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Facilities Tab -->
          <div *ngIf="activeTab === 'facilities'" class="tab-panel">
            <h2>Amenities</h2>
            <div class="amenities-grid">
              <div class="amenity-item" *ngFor="let amenity of amenities">
                <span>{{ amenity.label }}</span>
              </div>
            </div>
          </div>

          <!-- Schedule Tab -->
          <div *ngIf="activeTab === 'schedule'" class="tab-panel">
            <h2>Opening Hours</h2>
            <table class="schedule-table">
              <thead>
                <tr>
                  <th>Day</th>
                  <th>Opening Time</th>
                  <th>Closing Time</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let schedule of schedules">
                  <td>{{ schedule.day }}</td>
                  <td>{{ schedule.openingTime }}</td>
                  <td>{{ schedule.closingTime }}</td>
                  <td>
                    <span class="status-badge" [class.closed]="schedule.status.includes('Closed')">
                      {{ schedule.status }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Plans Tab -->
          <div *ngIf="activeTab === 'plans'" class="tab-panel">
            <div class="plans-grid">
              <div class="plan-card" *ngFor="let plan of plans" [class.selected]="selectedPlan === plan"
                [class.recommended]="plan.recommended">
                <span *ngIf="plan.recommended" class="recommended-badge">MOST POPULAR</span>
                <h3>{{ plan.name }}</h3>
                <p class="plan-description">Gives you {{ plan.visits }} visits</p>
                <div class="plan-price">
                  <span class="credits">{{ plan.credits }} Credits</span>
                </div>
                <button class="select-plan-btn" (click)="selectPlan(plan)">Select Plan</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="sidebar">
        <!-- Book a Visit Card (for Schedule tab) -->
        <div *ngIf="activeTab === 'schedule'" class="booking-card">
          <h3>Book a Visit</h3>

          <div class="form-group">
            <label>Select a Date</label>
            <input type="date" [(ngModel)]="selectedDate" [min]="minDate" placeholder="mm/dd/yyyy" />
          </div>

          <div class="form-group">
            <label>Select a Time</label>
            <div class="time-grid">
              <button *ngFor="let slot of timeSlots" class="time-slot" [class.selected]="selectedTime === slot.time"
                (click)="selectTime(slot.time)">
                {{ slot.label }}
              </button>
            </div>
          </div>

          <div class="cost-info" style="margin-bottom: 16px; font-weight: 600; color: #0f172a;">
            Cost per visit: {{ visitCreditsCost }} Credits
          </div>

          <button class="primary-btn" (click)="reserveSpot()">Reserve Your Spot</button>
        </div>

        <!-- Order Summary Card (for Plans tab) -->
        <div *ngIf="activeTab === 'plans'" class="order-card">
          <h3>Order Summary</h3>

          <div class="order-details">
            <div class="order-row">
              <span>{{ selectedPlan?.name || 'No plan selected' }}</span>
              <span>{{ selectedPlan?.credits || 0 }} Credits</span>
            </div>

            <div *ngIf="selectedPlan" class="plan-extra-details">
              <p class="summary-desc">{{ selectedPlan.description }}</p>
              <div class="summary-meta">
                <span *ngIf="selectedPlan.durationDays">Duration: {{ selectedPlan.durationDays }} Days</span>
                <span *ngIf="selectedPlan.visits">Visits: {{ selectedPlan.visits }}</span>
              </div>
            </div>

            <div class="order-row total">
              <span>Total</span>
              <span>{{ selectedPlan?.credits || 0 }} Credits</span>
            </div>
          </div>

          <p class="terms-text">
            By proceeding, you agree to our
            <a href="#">Terms of Service</a> and <a href="#">Cancellation Policy</a>. Your
            membership will auto-renew monthly.
          </p>

          <button class="primary-btn" (click)="proceedToPayment()">Proceed to Payment</button>

        </div>
      </aside>
    </div>
  </main>

  <!-- Success/Error Modal -->
  <div class="modal-overlay" *ngIf="showModal">
    <div class="modal-content" [class.error]="modalType === 'error'">
      <div class="modal-icon">
        <svg *ngIf="modalType === 'success'" width="64" height="64" viewBox="0 0 24 24" fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
            fill="#10B981" />
        </svg>
        <svg *ngIf="modalType === 'error'" width="64" height="64" viewBox="0 0 24 24" fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
            fill="#EF4444" />
        </svg>
      </div>
      <h3>{{ modalType === 'success' ? 'Success!' : 'Error' }}</h3>
      <p>{{ modalMessage }}</p>
      <button class="modal-btn" (click)="closeModal()">{{ modalType === 'success' ? 'View My Bookings' : 'Close'
        }}</button>
    </div>
  </div>

  <app-footer></app-footer>
</div>