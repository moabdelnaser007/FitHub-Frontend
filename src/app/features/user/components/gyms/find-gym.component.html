<div class="find-gym-page">
  <header class="top-nav">
    <a class="brand" routerLink="/"> FitHub </a>

    <!-- Desktop Nav -->
    <nav class="nav-links desktop-only">
      <a *ngFor="let link of navLinks" [routerLink]="link.isRoute ? link.href : null"
        [href]="link.isRoute ? null : link.href" (click)="handleNav(link, $event)">{{ link.label }}</a>
    </nav>

    <!-- Desktop Auth -->
    <div class="auth-actions desktop-only">
      <ng-container *ngIf="!isLoggedIn">
        <button class="ghost" routerLink="/login">Log in</button>
        <button class="primary" routerLink="/register">Sign Up</button>
      </ng-container>
      <ng-container *ngIf="isLoggedIn">
        <button class="profile-btn" (click)="navigateToProfile()" title="Go to Profile">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
              fill="currentColor" />
          </svg>
        </button>
        <button class="logout-btn" (click)="logout()" title="Logout">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
              fill="currentColor" />
          </svg>
        </button>
      </ng-container>
    </div>

    <!-- Mobile Hamburger -->
    <button class="hamburger-btn mobile-only" (click)="toggleMobileMenu()" aria-label="Toggle menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" [class.open]="mobileMenuOpen" (click)="closeMobileMenu()"></div>

    <!-- Mobile Menu Drawer -->
    <div class="mobile-menu-drawer" [class.open]="mobileMenuOpen">
      <div class="mobile-menu-header">
        <span class="brand">FitHub</span>
        <button class="close-btn" (click)="closeMobileMenu()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <nav class="mobile-nav-links">
        <a *ngFor="let link of navLinks" [routerLink]="link.isRoute ? link.href : null"
          [href]="link.isRoute ? null : link.href" (click)="handleNav(link, $event); closeMobileMenu()">
          {{ link.label }}
        </a>
      </nav>

      <div class="mobile-auth-actions">
        <ng-container *ngIf="!isLoggedIn">
          <button class="ghost w-full" routerLink="/login" (click)="closeMobileMenu()">Log in</button>
          <button class="primary w-full" routerLink="/register" (click)="closeMobileMenu()">Sign Up</button>
        </ng-container>
        <ng-container *ngIf="isLoggedIn">
          <button class="profile-btn-mobile" (click)="navigateToProfile(); closeMobileMenu()">
            Profile
          </button>
          <button class="logout-btn-mobile" (click)="logout(); closeMobileMenu()">
            Logout
          </button>
        </ng-container>
      </div>
    </div>

  </header>

  <main class="page-main">
    <!-- Main Content -->
    <section class="content">
      <div class="content-header">
        <h1>Find a Gym</h1>
        <p class="subtitle">Search by gym, activity, or location</p>
      </div>

      <!-- Filter Card -->
      <div class="filter-card">
        <!-- Top Row: Search, City, Rating -->
        <div class="filter-row top-row">
          <!-- Search -->
          <div class="filter-group group-search">
            <label class="label">Search</label>
            <div class="input-wrapper">
              <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
              <input type="text" [(ngModel)]="searchQuery" (keyup.enter)="onSearch()"
                placeholder="Search by gym name or address..." class="input-field" />
            </div>
          </div>

          <!-- City -->
          <div class="filter-group group-city">
            <label class="label">City</label>
            <div class="select-wrapper">
              <select [(ngModel)]="selectedCity" (change)="onFilterChange()" class="select-field">
                <option value="">All Cities</option>
                <option value="Cairo">Cairo</option>
                <option value="Giza">Giza</option>
                <option value="Alexandria">Alexandria</option>
                <!-- Add other cities as needed -->
              </select>
              <svg class="select-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
          </div>

          <!-- Rating -->
          <div class="filter-group group-rating">
            <label class="label">Min Rating</label>
            <div class="select-wrapper">
              <select [(ngModel)]="selectedRating" (change)="onFilterChange()" class="select-field">
                <option [ngValue]="0">Any Rating</option>
                <option [ngValue]="4.5">4.5+</option>
                <option [ngValue]="4.0">4.0+</option>
                <option [ngValue]="3.5">3.5+</option>
                <option [ngValue]="3.0">3.0+</option>
              </select>
              <svg class="select-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
          </div>

          <!-- Max Credits -->
          <div class="filter-group group-credits">
            <label class="label">Max Credits</label>
            <div class="input-wrapper">
              <input type="number" [(ngModel)]="selectedMaxCredits" (change)="onFilterChange()" placeholder="Ex. 50"
                min="0" class="input-field" />
            </div>
          </div>
        </div>

        <!-- Bottom Row: Amenities -->
        <div class="filter-row bottom-row">
          <div class="filter-group group-amenities">
            <label class="label">Amenities:</label>
            <div class="amenities-chips">
              <button *ngFor="let amenity of amenitiesList" class="chip"
                [class.active]="selectedAmenities.includes(amenity)" (click)="toggleAmenity(amenity)">
                {{ amenity }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <app-gym-list [filters]="currentFilters" (rateGym)="onRateGym($event)"></app-gym-list>
    </section>
  </main>

  <!-- Review Modal -->
  <div class="modal-backdrop" *ngIf="showReview" (click)="closeReview()"></div>
  <div class="modal" *ngIf="showReview" role="dialog" aria-modal="true">
    <h2 class="modal-title">Leave a Review</h2>
    <p class="modal-subtitle">Share your experience about {{ selectedGym?.name }}</p>

    <label class="field-label">Your Rating</label>
    <div class="stars-select" aria-label="Select rating">
      <button type="button" *ngFor="let i of [1, 2, 3, 4, 5]" class="star-btn" [class.filled]="rating >= i"
        (click)="setRating(i)" aria-label="Rate {{ i }} star"></button>
    </div>

    <label class="field-label" for="review-text">Write your review here...</label>
    <textarea id="review-text" class="textarea" [(ngModel)]="reviewText" rows="5"
      placeholder="Write your review here..."></textarea>

    <label class="checkbox">
      <input type="checkbox" [(ngModel)]="anonymous" />
      <span>Make my review anonymous</span>
    </label>

    <div class="modal-actions">
      <button class="btn primary" (click)="submitReview()">Submit Review</button>
      <button class="btn ghost" (click)="closeReview()">Cancel</button>
    </div>
  </div>

  <app-footer></app-footer>
</div>