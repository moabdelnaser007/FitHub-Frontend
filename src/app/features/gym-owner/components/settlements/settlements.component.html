<div class="container">
    <main class="main-content">
        <div class="content-wrapper">

            <!-- Header -->
            <div class="header-section">
                <div class="header-text">
                    <h1>Settlements</h1>
                    <p>Manage your payout requests and view history.</p>
                </div>

                <div class="header-actions">
                    <!-- Search -->
                    <div class="search-box">
                        <span class="material-symbols-outlined search-icon">search</span>
                        <input type="text" placeholder="Search by ID or Status..." [(ngModel)]="searchText"
                            (keyup)="onSearch()" />
                    </div>

                    <!-- Filter -->
                    <div class="filter-container" style="position: relative;">
                        <button class="filter-btn" (click)="onFilter()">
                            <span class="material-symbols-outlined">filter_list</span>
                            {{ selectedStatus ? selectedStatus : 'Filter' }}
                        </button>
                        <div *ngIf="showFilterMenu" class="filter-dropdown">
                            <div class="filter-item" (click)="selectStatusFilter(null)">All</div>
                            <div *ngFor="let status of uniqueStatuses" class="filter-item"
                                (click)="selectStatusFilter(status)">
                                {{ status }}
                            </div>
                        </div>
                    </div>

                    <!-- Create Button -->
                    <button class="btn-add" (click)="openCreateModal()">
                        <span class="material-symbols-outlined">add</span>
                        <span>Create Settlement</span>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="table-container">
                <div class="table-wrapper">

                    <!-- Loading & Error -->
                    <div *ngIf="isLoading" class="loading-state">
                        <div class="spinner"></div>
                        <p>Loading settlements...</p>
                    </div>

                    <div *ngIf="error" class="error-state">
                        <span class="material-symbols-outlined">error</span>
                        <p>{{ error }}</p>
                    </div>

                    <!-- Table -->
                    <table *ngIf="!isLoading && !error">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Created At</th>
                                <th>Payout Date</th>
                                <th>Admin Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of filteredSettlements">
                                <td>#{{ item.id }}</td>
                                <td>{{ item.amount | currency }}</td>
                                <td>
                                    <span class="status-badge" [ngClass]="getStatusClass(item.status)">
                                        {{ item.status }}
                                    </span>
                                </td>
                                <td>{{ item.createdAt | date:'medium' }}</td>
                                <td>{{ item.payoutDate ? (item.payoutDate | date:'medium') : '-' }}</td>
                                <td>{{ item.adminNotes || '-' }}</td>
                            </tr>

                            <!-- Empty State -->
                            <tr *ngIf="filteredSettlements.length === 0">
                                <td colspan="6" class="empty-state">
                                    <span class="material-symbols-outlined empty-icon">payments</span>
                                    <p>No settlements found</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>

                <!-- Footer -->
                <div class="table-footer" *ngIf="!isLoading && !error">
                    <span class="footer-text">Showing {{ filteredSettlements.length }} entries</span>
                </div>
            </div>

        </div>
    </main>

    <!-- Create Settlement Modal -->
    <div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Request Settlement</h2>
            </div>

            <div class="modal-body" style="text-align: left;">
                <p>Enter the amount you wish to withdraw.</p>
                <br>
                <div class="form-group">
                    <label for="amount">Amount</label>
                    <input type="number" id="amount" [(ngModel)]="newSettlementAmount" class="form-control"
                        placeholder="0.00" min="1" />
                </div>
                <p *ngIf="createError" style="color: red; margin-top: 8px; font-size: 14px;">{{ createError }}</p>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel-modal" (click)="closeCreateModal()" [disabled]="isCreating">Cancel</button>
                <button class="btn-confirm-modal" (click)="submitSettlement()" [disabled]="isCreating">
                    <span *ngIf="!isCreating">Submit Request</span>
                    <span *ngIf="isCreating">Submitting...</span>
                </button>
            </div>
        </div>
    </div>
</div>